{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observer {\n  constructor(data) {\n    // Object.defineProperty 只能劫持已经存在的属性，新增、删除的都无法\n    // vue2中为此还专门写了一个api: $set $delete\n    this.walk(data);\n  }\n\n  walk(data) {\n    // 循环data对象，对属性依次进行劫持\n\n    // “重新定义”属性：性能就有减弱了\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n}\n\n// 属性劫持\nexport function defineReactive(target, key, value) {\n  // 如果还是对象，就需要再次进行劫持\n  observe(value);\n  // 这里使用了闭包\n  Object.defineProperty(target, key, {\n    configurable: true,\n    get() {\n      console.log(\"用户取值了,key: \", key);\n      // 取值的时候,会执行 get\n      return value;\n    },\n    set(newValue) {\n      console.log(\"用户设置值了,key: \", key);\n      // 修改的时候，会执行 set\n      if (newValue !== value) {\n        value = newValue;\n      }\n    },\n  });\n}\n\nexport function observe(data) {\n  // 对这个对象进行劫持\n  if (typeof data !== \"object\" || data == null) {\n    return; // 只对对象进行劫持\n  }\n  // 如果一个对象被劫持过了，那就不需要在被劫持了\n  // 要判断一个对象是否被劫持过，可以增加一个实例，用实例来判断是否被劫持过\n\n  return new Observer(data);\n}\n","import { observe } from \"./observe/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n\n  if (opts.data) {\n    initData(vm);\n  }\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data; // data 可能是函数和对象\n\n  data = typeof data === \"function\" ? data.call(this) : data;\n\n  vm._data = data;\n  // 对数据进行接触，vue2中采用了一个api： defineProperty\n  observe(data);\n\n  // 将 vm._data 用 vm 来代理就可以了\n  for (const key in data) {\n    proxy(vm, \"_data\", key);\n  }\n}\n\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(val) {\n      vm[target][key] = val;\n    },\n  });\n}\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  // 就是给 vue 增加 init 方法的\n  Vue.prototype._init = function (options) {\n    // 用户初始化操作\n    // vue vm.$options 就是获取用户的配置项\n\n    const vm = this;\n\n    vm.$options = options; // 将用户的选项挂在在实例上\n\n    // 初始化状态\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  // options 就是用户的选项\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["Observer","data","_classCallCheck","walk","_createClass","key","value","Object","keys","forEach","defineReactive","target","observe","defineProperty","configurable","get","console","log","set","newValue","_typeof","initState","vm","opts","$options","initData","call","_data","proxy","val","initMixin","Vue","prototype","_init","options"],"mappings":"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"}